import numpy as np
import math
import casadi as ca
import pwlf

from igp2.trajectory import VelocityTrajectory, VelocitySmoother

velocity = np.array([10.,  9.65219087,  9.3043612,  8.95649589,  8.60861904,
                     8.26077406,  7.91295965,  7.56514759,  7.21732575,  6.86950166,
                     6.52166818,  6.17383606,  5.82603222,  5.4782067,  5.13039544,
                     4.78256806,  4.43475039,  4.08692743,  3.73910688,  3.39128599,
                     3.04346456,  2.69564081,  2.3478209,  2., 4.94224523,
                     4.3791341,  5.92469626, 7.14872029, 8.02758482, 8.67158042,
                     9.26201364,  9.58410871])

path = np.array([[18.2,  -9.5],
                 [19.08138189, -10.11367683],
                 [19.95412248, -10.73969068],
                 [20.82038646, -11.3748227],
                 [21.68233851, -12.015854],
                 [22.54207464, -12.65969006],
                 [23.40107722, -13.30434721],
                 [24.26047047, -13.94847137],
                 [25.11980136, -14.59272908],
                 [25.97644681, -15.24056476],
                 [26.82814053, -15.89494435],
                 [27.67864037, -16.55086796],
                 [28.53560005, -17.19818417],
                 [29.40105998, -17.8342039],
                 [30.26174808, -18.47659271],
                 [31.11446112, -19.12961246],
                 [31.97113869, -19.7773728],
                 [32.83288111, -20.41840715],
                 [33.69324285, -21.06128093],
                 [34.55453678, -21.702907],
                 [35.41472575, -22.34601647],
                 [36.2738406, -22.99057206],
                 [37.13002855, -23.63899089],
                 [37.98267959, -24.2920587],
                 [38.84510881, -24.87269119],
                 [39.8773382, -25.09510637],
                 [40.97168375, -25.10699908],
                 [42.10314107, -24.94812288],
                 [43.24670576, -24.65823132],
                 [44.37737341, -24.27707795],
                 [45.47013963, -23.84441633],
                 [46.5, -23.4]
                 ])

# give-way and turn maneuvers with unsmoothed velocities
trajectory = VelocityTrajectory(path, velocity)

vel_smoother = VelocitySmoother(path, velocity, amax_m_s2=10)
sol = vel_smoother.smooth_velocity()
print(sol)